<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Todo MyList - {{ user_info.username }}님의 리스트</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>
<link href="{{ url_for('static', filename='main.css') }}" rel="stylesheet"/>
</head>
<body>
  <!-- 상단 네비게이션 바 -->
  <div class="top-bar">
    <div class="nav-slider slide-mylist">
      <div class="nav-buttons">
        <button id="homeBtn" class="inactive" data-page="home">홈</button>
        <button id="mylistBtn" class="active" data-page="mylist">
          내 리스트
          <div class="todo-stats" id="todoStats" style="font-size: 0.7rem; opacity: 0.9; margin-top: 2px;">
            <span id="completedCount">0</span>/<span id="totalCount">0</span>
          </div>
        </button>
        <button id="rankingBtn" class="inactive" data-page="ranking">랭킹</button>
      </div>
    </div>
    
    <!-- 로그아웃 링크 -->
    <a href="#" id="logoutLink" class="logout-link">로그아웃</a>
  </div>

  <!-- 메인 컨테이너 -->
  <div class="container-narrow" id="todoContainer">
    <!-- JavaScript에서 동적으로 채워짐 -->
  </div>
  
  <!-- 할일 추가 버튼 -->
  <button class="add-btn" id="addBtn" title="새 카드 추가">+</button>

  <!-- 새 카드 추가 모달 -->
  {% set add_modal = modals.add_modal %}
  <div class="modal-backdrop" id="addModal">
    <div class="modal-content">
      <h5>{{ add_modal.title }}</h5>
      
      {% for field in add_modal.fields %}
        {% if field.type == 'text' %}
          <input type="text" id="{{ field.id }}" placeholder="{{ field.placeholder }}" maxlength="30"/>
        {% elif field.type == 'textarea' %}
          <textarea id="{{ field.id }}" rows="{{ field.rows }}" placeholder="{{ field.placeholder }}" maxlength="50"></textarea>
        {% elif field.type == 'datetime-local' %}
          <label>{{ field.label }}</label>
          <div class="datetime-group" style="display: grid; grid-template-columns: 1fr 1fr 1fr 1fr 1fr; gap: 0.5rem; align-items: center;">
            <div>
              <label style="font-size: 0.8rem; color: #666;">년</label>
              <input type="number" id="{{ field.id }}_year" min="2025" max="2030" style="width: 100%;" placeholder="년" />
            </div>
            <div>
              <label style="font-size: 0.8rem; color: #666;">월</label>
              <input type="number" id="{{ field.id }}_month" min="1" max="12" style="width: 100%;" placeholder="월" />
            </div>
            <div>
              <label style="font-size: 0.8rem; color: #666;">일</label>
              <input type="number" id="{{ field.id }}_day" min="1" max="31" style="width: 100%;" placeholder="일" />
            </div>
            <div>
              <label style="font-size: 0.8rem; color: #666;">시</label>
              <input type="number" id="{{ field.id }}_hour" min="0" max="23" style="width: 100%;" placeholder="시" />
            </div>
            <div>
              <label style="font-size: 0.8rem; color: #666;">분</label>
              <input type="number" id="{{ field.id }}_minute" min="0" max="59" style="width: 100%;" placeholder="분" />
            </div>
          </div>
        {% elif field.type == 'select' %}
          <label>{{ field.label }}</label>
          <select id="{{ field.id }}">
            {% for option in field.options %}
            <option value="{{ option.value }}">{{ option.text }}</option>
            {% endfor %}
          </select>
        {% endif %}
      {% endfor %}
      
      <div class="modal-actions">
        {% for button in add_modal.buttons %}
        <button class="{{ button.class }}" id="{{ button.id }}">{{ button.text }}</button>
        {% endfor %}
      </div>
    </div>
  </div>

  <!-- 카드 수정 모달 -->
  {% set edit_modal = modals.edit_modal %}
  <div class="modal-backdrop" id="editModal">
    <div class="modal-content">
      <h5>{{ edit_modal.title }}</h5>
      
      {% for field in edit_modal.fields %}
        {% if field.type == 'text' %}
          <input type="text" id="{{ field.id }}" placeholder="{{ field.placeholder }}" maxlength="30" />
        {% elif field.type == 'datetime-local' %}
          <label>{{ field.label }}</label>
          <div class="datetime-group" style="display: grid; grid-template-columns: 1fr 1fr 1fr 1fr 1fr; gap: 0.5rem; align-items: center;">
            <div>
              <label style="font-size: 0.8rem; color: #666;">년</label>
              <input type="number" id="{{ field.id }}_year" min="2020" max="2030" style="width: 100%;" placeholder="2025" />
            </div>
            <div>
              <label style="font-size: 0.8rem; color: #666;">월</label>
              <input type="number" id="{{ field.id }}_month" min="1" max="12" style="width: 100%;" placeholder="월" />
            </div>
            <div>
              <label style="font-size: 0.8rem; color: #666;">일</label>
              <input type="number" id="{{ field.id }}_day" min="1" max="31" style="width: 100%;" placeholder="일" />
            </div>
            <div>
              <label style="font-size: 0.8rem; color: #666;">시</label>
              <input type="number" id="{{ field.id }}_hour" min="0" max="23" style="width: 100%;" placeholder="시" />
            </div>
            <div>
              <label style="font-size: 0.8rem; color: #666;">분</label>
              <input type="number" id="{{ field.id }}_minute" min="0" max="59" style="width: 100%;" placeholder="분" />
            </div>
          </div>
        {% elif field.type == 'select' %}
          <label>{{ field.label }}</label>
          <select id="{{ field.id }}">
            {% for option in field.options %}
            <option value="{{ option.value }}">{{ option.text }}</option>
            {% endfor %}
          </select>
        {% endif %}
      {% endfor %}

      <!-- 동적 컨텐츠 리스트 -->
      <ul class="content-list" id="editContentList"></ul>
      <div style="display:flex;gap:.5rem">
        <input type="text" id="editNewContent" placeholder="체크리스트 항목 추가" maxlength="40"/>
        <button class="primary" id="addEditContent">추가</button>
      </div>

      <div class="modal-actions">
        {% for button in edit_modal.buttons %}
        <button class="{{ button.class }}" id="{{ button.id }}">{{ button.text }}</button>
        {% endfor %}
      </div>
    </div>
  </div>

  <!-- 상세 보기 모달 -->
  {% set view_modal = modals.view_modal %}
  <div class="modal-backdrop" id="viewModal">
    <div class="modal-content">
      <h5 id="viewTodoTitle">제목</h5>
      <p id="viewTodoDesc" class="text-muted">부제목</p>
      <div id="viewContentList"></div>
      <div class="modal-actions">
        {% for button in view_modal.buttons %}
        <button class="{{ button.class }}" id="{{ button.id }}">{{ button.text }}</button>
        {% endfor %}
      </div>
    </div>
  </div>

  <!-- 사용자 정보를 JavaScript로 전달 -->
  <script>
    window.userInfo = {
      username: "{{ user_info.username }}",
      userId: "{{ user_info.user_id }}"
    };
    window.pageType = "mylist"; // 페이지 타입 식별
  </script>
  
<script src="{{ url_for('static', filename='mylist.js') }}"></script>
</body>
</html>
